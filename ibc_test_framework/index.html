<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="IBC Relayer Integration Test Framework"><title>ibc_test_framework - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-0ef3deca4ed45ad8.css" id="mainThemeStyle"><link rel="stylesheet" id="themeStyle" href="../static.files/light-f501212b8b071243.css"><link rel="stylesheet" disabled href="../static.files/dark-e92fc12c34ff89d3.css"><link rel="stylesheet" disabled href="../static.files/ayu-a0090c8b1ced384f.css"><script src="../static.files/storage-3891ce972e3a2bf8.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-364b95f387bc3166.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../ibc_test_framework/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../ibc_test_framework/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Crate ibc_test_framework</a></h2><div class="sidebar-elems"><ul class="block"><li class="version">Version 0.23.1</li><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#modules">Modules</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-5ec35bf9ca753509.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">ibc_test_framework</a><button id="copy-path" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../src/ibc_test_framework/lib.rs.html#2-83">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="ibc-relayer-integration-test-framework"><a href="#ibc-relayer-integration-test-framework">IBC Relayer Integration Test Framework</a></h2><h3 id="overview"><a href="#overview">Overview</a></h3>
<p>The <code>ibc-test-framework</code> crate provides the infrastructure and framework for writing end-to-end (E2E) tests that include the spawning of the relayer together with Cosmos full nodes running as child processes inside the tests.</p>
<h3 id="installation"><a href="#installation">Installation</a></h3>
<p>Other than Rust, the test suite assumes the <code>gaiad</code> binary is present in <code>$PATH</code>. You can install Gaia by either <a href="https://github.com/cosmos/gaia">building from source</a>, or load it using <a href="https://github.com/informalsystems/cosmos.nix/">Cosmos.nix</a>:</p>
<div class="example-wrap"><pre class="language-text"><code>nix shell github:informalsystems/cosmos.nix#gaia7
</code></pre></div>
<p>Alternatively, you can use <code>$CHAIN_COMMAND_PATH</code> to override with a different executable that is compatible with <code>gaiad</code>.</p>
<h3 id="examples"><a href="#examples">Examples</a></h3>
<p>Example tests written using <code>ibc-test-framework</code> can be found in the <a href="https://github.com/informalsystems/hermes/tree/master/tools/integration-test"><code>ibc-rs</code> project repository</a></p>
<h3 id="diagrams"><a href="#diagrams">Diagrams</a></h3>
<p>Some diagrams have been prepared to ease the understanding of the test framework:</p>
<ul>
<li><a href="https://app.excalidraw.com/l/4XqkU6POmGI/7za2eSTChuT">Tagged Identifiers and Data Structures</a></li>
<li><a href="https://app.excalidraw.com/l/4XqkU6POmGI/5y6i0NKqiEv">Test Data Structures</a></li>
<li><a href="https://app.excalidraw.com/l/4XqkU6POmGI/80KAnVZ6cu4">Test Framework Traits</a></li>
</ul>
<h3 id="overview-1"><a href="#overview-1">Overview</a></h3>
<p>This IBC test framework gives developers working on relayer software in Rust a robust
yet flexible suite of functionality to test the correctness of their relayer implementations,
as well as verify the expected state of chains in response to relayed messages and packets.</p>
<h3 id="running-tests"><a href="#running-tests">Running Tests</a></h3>
<p>We can run tests via the command line as follows:</p>
<div class="example-wrap"><pre class="language-bash"><code>RUST_LOG=info RUST_BACKTRACE=1 \
    cargo test -p ibc-integration-test --features example -- --test-threads=1 \
    example_test
</code></pre></div>
<p>The environment variable <code>RUST_LOG</code> controls log filtering for Hermes and,
besides the global log level, can be used to pass more elaborate directives
for the tracing framework. The <code>RUST_BACKTRACE</code> variable
displays a backtrace when errors occur in a test. The test flag <code>--test-threads=1</code> is
set so that tests are run serially (this makes it easier to follow what is going on
via the log output). Take a look at the <a href="types/config/struct.TestConfig.html"><code>TestConfig</code></a>
type for more information about configuring how tests can be run.</p>
<p>For this example, we disable the test from running by default, since it calls the
<code>suspend</code> function and will thus never pass. We explicitly pass <code>--features example</code>
so that the <code>example</code> feature is activated such that this test will run. Finally, we
specify the name of the test so that <em>only</em> our example test is run.</p>
<p>After starting the test run, we may see logs such as the following:</p>
<div class="example-wrap"><pre class="language-text"><code>$ cargo test -p ibc-integration-test --features example -- --nocapture --test-threads=1 example_test
...
INFO created new chain/client/connection/channel from ibc-alpha-c4aed8f9/07-tendermint-4/connection-6/channel-1 to ibc-beta-fcb867bb/07-tendermint-6/connection-1/channel-6
INFO written channel environment to /path/to/ibc-rs/tools/integration-test/data/test-1094235493/binary-channels.env
WARN suspending the test indefinitely. you can still interact with any spawned chains and relayers
...
</code></pre></div>
<p>The INFO lines are notifying us of the path environment variables exported by the test.
The WARN line states that the test has been suspended indefinitely, as we knew it would.
Note that the chains are created with random IDs and are listening on random ports.</p>
<p>Using the logs, we can for example use <code>gaiad</code> to query for the balance of the accounts
created by the test by running:</p>
<div class="example-wrap"><pre class="language-bash"><code>$ source /path/to/ibc-rs/tools/integration-test/data/test-1094235493/binary-channels.env
$ gaiad --home &quot;$NODE_A_HOME&quot; --node $NODE_A_RPC_ADDR query bank balances $NODE_A_WALLETS_USER1_ADDRESS
balances:
- amount: &quot;6902395390297&quot;
denom: coin95143d31
- amount: &quot;6902395390297&quot;
denom: stake
pagination:
next_key: null
total: &quot;0&quot;
</code></pre></div>
<p>The test data and configuration files are stored at the absolute path shown in the
log, which looks something like <code>/path/to/ibc-rs/tools/integration-test/data/test-1094235493</code>.
The sub-directory <code>test-1094235493</code> is randomly generated at the beginning of a test
case such that all data related to that test lives in the same directory.</p>
</div></details><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2><div class="item-table"><div class="item-row"><div class="item-left"><a class="mod" href="bootstrap/index.html" title="mod ibc_test_framework::bootstrap">bootstrap</a></div><div class="item-right docblock-short">Helper functions for setting up test cases in an imperative way.</div></div><div class="item-row"><div class="item-left"><a class="mod" href="chain/index.html" title="mod ibc_test_framework::chain">chain</a></div><div class="item-right docblock-short">Constructs for spawning and managing full nodes, e.g. the
Gaia chains.</div></div><div class="item-row"><div class="item-left"><a class="mod" href="docs/index.html" title="mod ibc_test_framework::docs">docs</a></div><div class="item-right docblock-short">Documentation-only module containing long-form docs and walkthroughs.</div></div><div class="item-row"><div class="item-left"><a class="mod" href="error/index.html" title="mod ibc_test_framework::error">error</a></div><div class="item-right docblock-short">Error type used for the tests.</div></div><div class="item-row"><div class="item-left"><a class="mod" href="framework/index.html" title="mod ibc_test_framework::framework">framework</a></div><div class="item-right docblock-short">Framework code for making it easier to write test cases.</div></div><div class="item-row"><div class="item-left"><a class="mod" href="ibc/index.html" title="mod ibc_test_framework::ibc">ibc</a></div><div class="item-right docblock-short">Code that may belong to the <code>ibc</code> module, but are currently
in this crate for easier review or maintenance.</div></div><div class="item-row"><div class="item-left"><a class="mod" href="prelude/index.html" title="mod ibc_test_framework::prelude">prelude</a></div><div class="item-right docblock-short">Re-export of common constructs that are used by test cases.</div></div><div class="item-row"><div class="item-left"><a class="mod" href="relayer/index.html" title="mod ibc_test_framework::relayer">relayer</a></div><div class="item-right docblock-short">Code that may belong to the <a href="../ibc_relayer/index.html" title="ibc_relayer"><code>ibc_relayer</code></a> module, but are currently
in this crate for easier review or maintenance.</div></div><div class="item-row"><div class="item-left"><a class="mod" href="types/index.html" title="mod ibc_test_framework::types">types</a></div><div class="item-right docblock-short">This module contains definitions of core data structures that are used
in the test suite.</div></div><div class="item-row"><div class="item-left"><a class="mod" href="util/index.html" title="mod ibc_test_framework::util">util</a></div><div class="item-right docblock-short">Utility and helper functions used in the tests.</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="ibc_test_framework" data-themes="" data-resource-suffix="" data-rustdoc-version="1.69.0-nightly (ef934d9b6 2023-02-08)" data-search-js="search-28136cea55c34037.js" data-settings-js="settings-f0c5c39777a9a2f6.js" data-settings-css="settings-0bcba95ff279c1db.css" ></div></body></html>